const CITAT = ["Jag får ha sex när jag vill!", "Man drabbas av momentan övervikt", "Saftig hjärnskakning", "Det är judarnas fel", "Fysik... är... roligt...", "Fysiken är gosig. Iallafall friktionen.", "Hördu! Här är det hårdrock som gäller! Ingen sådan här jävla skitmusik!", "Den liknelsen är egentligen inte helt rätt, eller egentligen är den inte rätt överhuvudtaget.", "Om Hampus ska ha ett hamsterhjul, vad ska vi ge dig då Jonah, en val?", "Om nu saker inte är så ideala som jag är...", "Vad är gimpsuit?", "Bistro Physique, vill du se vinlistan?", "Serveringen är stängd.", "Fysik är kärlek.", "Allt är tomrum, det är bara att öppna godtyckligt huvud och titta.", "Frågan är ju om ni har indval matte C.", "Ja, det ska det ju också kunna bli... nu blev jag ledsen. Åh, vad trött jag blir! Nu övergår vi till problemlösning!", "Det vi letar efter är punkter med samma spänning... ooo, en slips!", "Det är inte kinesisk energi, det är ris", "Världen är ju trots allt mer än fysik", "Jag förnekar! Citera det med!", "Också har vi det andra Fysik priset, officiellt kallat kemipriset", "Beware, the sorcerer is here", "Det här är en vibrator. Den använder jag till både det ena och det andra", "Natrium och Koppar, de Svenska grundämnena...... Eller kanske inte", "Fyra fingrar?! Ett, två, tre, fyra, fyra. Jo det stämmer ju.", "Rektorer förgår, Lars består!", "God does play dice. En fyra", "Inga orgier på mina lektioner. Dem är orgiefria", "Vilket drömläge, tempus upphör. Franska är helt plötsligt göbart!", "Den är per definition fin. Det är en fysikbok.", "Jorden är inte en sfär, det är en halvsfär.", "Hoppas den dör av övervikt", "Så han räknade ut avståndet till solen. Strålande!", "Det svåra med fysiken är just fysiken. Det är ett klassiskt muppfel det där.", "Män i antikens grekland behövde ha något kul att göra på kvällarna, så de gnuggade bärnsten med kattpäls", "Jag vet att jag har en örnblick som isar blod men vi måste kunna ha en bra stämning utan att jag behöver titta på er", "Ni har ingen aning om vad jag mätt och hur jag mätt", "Jag blir alltid misstänksam när någon ler [under min lektion]", "Vågar man använda vågar?", "Ohm och endast Ohm", "Värmer man lite kan man få precis vad som helst.", "Det är de två kulorna här nere som är intressangta", "Man är sin egen kock på den här restaurangen", "Nu hamnar det nog på någon citatlista [...] Shit happens", "Det heter kub, oavsett form", "Det finns hur många [formler] som helst, beroende på vad man vill göra", "Strunta i det anständiga", "Det är en brist i evolutionen, den har inte gett fysiklärare tre armar", "Jag ger utslag på geigermätare", "Knark ...eh jag menar kraft", "Fak off", "Ursäkta det där sa jag inte", "Man kan likställa matematik med kötthantering", "Min hand är höjs", "Nej nej nej, om ni vill ha mer så får ni mer!", "Jag hade hoppats på fem i.", "Jag älskar att kladda!", "Jag sover alltid!", "To per or not to pee", "Det är en magisk sten", "Jag känner mig på en kreativ form, det bara sprutar ut dumheter. Mer än vanligt menar jag", "En cirkel. Mitt kungarike för en cirkel.", "Och idag skapade vi liv på fysiklektionen", "Oj, nu blev det mörkt.", "Jag är fysiker, jag styr världen.", "Roten ur 3 finns.", "Jag har lärt mig av Trump, you're fired!", "Lars ska hålla käften helt enkelt.", "Värmer man lite kan man få precis vad som helst.", "Inget ont om polackerna men de är lite värre.", "Jag tycker alltid att de är svåra att motstå. De brukar vara svåra att monstå då man är 3, 4, 5 år, då vet ni hur gammal jag är.", "I fysiken träffar oändligheten ganska fort.", "Oändligheten är helt klart varierande begrepp.", "Felet ni gjorde var att ni antog att alla klockor var synkroniserade, trots att ni går på Dagy där inga av klockorna är det.", "Det är därför lärare rör sig, för att inte åldras så fort.", "jag vill inte hålla på med accelleration och sådant krafs, det blir bara stök.", "Ni ska lyssna lagon på det jag säger.", "Mina fingrar är nu relativistiska", "Det här finns inte med i kursen, men jag vill ta upp det ändå", "Ljuset går ju för att uttrycka sig vulgärt skitfort ", "Det jag och mina vänner gjorde var väl egentligen att råna ett kassaskåp", "Det här var godnattsagan för veckan!", "Du får ingen glädje här heller, det här är en mobbarlektion.", "Det finns bara en vagn i hela världen.", "Ni kan nöja er med centrum av universum, Danderyds Gymnasium.", "Alla äter inte kött. Vissa ger sig på växterna direkt, men det är egentligen ingen skillnad.", "Den har ju lite av... Floppa-floppa-floppa-floppa-tendensen, fast lite snabbare.", "Övergången mellan ett kvadratiskt eller linjärt synsätt är... Svävande.", "Fem och tre ser nästan likadana ut.", "Alltid detta ritande. Alltid detta fingrande.", "Jag har inte råd att köpa 20 mikrovågsugnar!", "Jag vågar sticka ut huvudet, för jag är minoritet.", "Vi har 0° hemma, 0° Kelvin hemma.", "Fuck Google!", "Ni kommer att slaktas", "Usch", "Det blir bättre, alltså skummare", "Den är oerhört viktig, oavsett litenhet", "I am hot", "Man kan inte fingra sig själv, fast man kan göra observationer av det", "Han stönar", "Jul? Borta!", "Någon frivillig radon-andare?", "För tidigt på dagen för geigermätaren, den behöver nog gå och lägga sig", "Det blir väder på provet, det blir solsken", "Jag är en världsbildssabbare, det är mitt jobb", "Jag är från vikingatiden", "De är på och fingrar på ställen där de inte har att göra", "Det var inte sån attraktion vi ville ha...", "Nyttig genom onyttig, Igors kvot", "Månens påverkan är ganska liten, om man inte är varulv då", "Så vackert, copy-paste!", "Allt förklaras fysikaliskt, till och med Svampbob", "Relativitetsterrorist", "Inte i fysik 1, magin kommer i fysik 2. I fysik 3, då får ni egna trollstavar", "Får man hålla med?", "Jag är för hård", "Våld löser mycket", "Det är så här stora kattdjur jagar", "Har någon benägenhet för epilepsi?", "Man måste tänka sig för vad man säger, så man inte säger det man tänker", "... Och då är det inte texter vi bränner utan människor", "Är en gummisnodd en bra modell av ett järnklot?"];

function to_millis(minutes) {
	return minutes * 60 * 1000;
}

function lesson(begin, end, pred = null) {
	return {
		'begin': Date.parse(begin),
		'end': Date.parse(end),
		'pred': pred,
	}
}

let user_settings = {
	'lang': 'fra',
	'2c': false,
	'extra_fysik': false,
	'sva': false,
	'long_math': false,
	'bio': true,
	'sam': true,
	'idr': true,
	'eng': true,
	'fysik': true,
	'svenska': true,
	'ma5': true,
	'prim_fys': false,
};

function matches(user_settings, x) {
	for (const key in x) {
		console.assert(key in user_settings === true);
		if (user_settings[key] !== x[key])
			return false;
	}
	return true;
}

function has_lesson(lesson) {
	return lesson.pred === null ? true : matches(user_settings, lesson.pred);
}

const LESSONS = [
	lesson("2025-06-02T08:20", "2025-06-02T09:40", { '2c': true }),
	lesson("2025-06-02T09:50", "2025-06-02T10:55", { 'eng': true }),
	lesson("2025-06-02T12:05", "2025-06-02T12:55", { 'lang': 'fra' }),
	lesson("2025-06-02T11:05", "2025-06-02T12:20", { 'lang': 'spa' }),
	lesson("2025-06-02T11:05", "2025-06-02T11:55", { 'lang': 'deu' }),
	lesson("2025-06-02T13:05", "2025-06-02T15:25", { 'long_math': false }),
	lesson("2025-06-02T13:05", "2025-06-02T16:05", { 'long_math': true }),
	
	lesson("2025-06-03T09:10", "2025-06-03T10:35", { 'sam': true }),
	lesson("2025-06-03T10:50", "2025-06-03T11:40", { 'idr': true }),
	lesson("2025-06-03T12:30", "2025-06-03T14:40", { '2c': true }),
	lesson("2025-06-03T14:50", "2025-06-03T16:20", { 'eng': true }),

	lesson("2025-06-05T08:20", "2025-06-05T09:35", { 'bio': true }),
	lesson("2025-06-05T09:35", "2025-06-05T11:00", { 'svenska': true }),
	lesson("2025-06-05T11:15", "2025-06-05T11:40", { 'sva': true }),
	lesson("2025-06-05T11:40", "2025-06-05T12:50", { '2c': true }),

	//

	lesson("2025-06-09T08:20", "2025-06-09T09:40", { '2c': true }),
	lesson("2025-06-09T09:50", "2025-06-09T10:55", { 'eng': true }),
	lesson("2025-06-09T11:05", "2025-06-09T12:20", { 'lang': 'spa' }),
	lesson("2025-06-09T11:05", "2025-06-09T11:55", { 'lang': 'deu' }),
	lesson("2025-06-09T12:30", "2025-06-09T14:30", { 'fysik': true }),
	lesson("2025-06-09T14:50", "2025-06-09T16:05", { 'extra_fysik': true }), // kanske ta bort

	lesson("2025-06-10T09:10", "2025-06-10T10:35", { 'sam': true }),
	lesson("2025-06-10T10:50", "2025-06-10T11:40", { 'idr': true }),
	lesson("2025-06-10T12:30", "2025-06-10T14:40", { '2c': true }),
	lesson("2025-06-10T14:50", "2025-06-10T16:20", { 'eng': true }),

	lesson("2025-06-11T08:20", "2025-06-11T09:30", { 'prim_fys': true, 'fysik': true }),
	lesson("2025-06-11T09:40", "2025-06-11T10:50", { 'prim_fys': false, 'fysik': true }),
	lesson("2025-06-11T08:20", "2025-06-11T09:30", { 'prim_fys': false, 'bio': true }),
	lesson("2025-06-11T09:40", "2025-06-11T10:50", { 'prim_fys': true, 'bio': true }),
	lesson("2025-06-11T12:10", "2025-06-11T13:05", { 'lang': 'fra' }),
	lesson("2025-06-11T11:05", "2025-06-11T12:25", { 'lang': 'spa' }),
	lesson("2025-06-11T11:05", "2025-06-11T12:00", { 'lang': 'deu' }),
	lesson("2025-06-11T13:15", "2025-06-11T14:25", { 'ma5': true }),
	lesson("2025-06-11T13:35", "2025-06-11T15:05"),
];

for (const lesson of LESSONS) {
	console.assert(lesson.end - lesson.begin <= 1000 * 3600 * 3, lesson);
}

function time_left() {
	const now = Date.now();
	return LESSONS
		.filter(x => x.end >= now)
		.filter(x => has_lesson(x))
		.reduce((acc, curr) => acc += (curr.end - now) - Math.max(curr.begin - now, 0), 0);
}

const main_time_element = document.querySelector('.main_time');

function destructure_millis(millis) {
	const hours = Math.floor(millis / 1000 / 3600);
	millis -= hours * 1000 * 3600;
	const minutes = Math.floor(millis / 1000 / 60);
	millis -= minutes * 1000 * 60;
	const seconds = Math.floor(millis / 1000);
	millis -= seconds * 1000;
	return { hours, minutes, seconds };
}

function format_millis(millis) {
	const { hours, minutes, seconds } = destructure_millis(millis);
	return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
}

let YAY = false;

let HAS_OPTIONS = !!localStorage.getItem('opt');

if (!HAS_OPTIONS) {
	document.querySelectorAll('input').forEach(x => ((x.checked = user_settings[x.id]), x.addEventListener('input', e => {
		console.assert(typeof e.target.checked === 'boolean');
		console.assert(e.target.id in user_settings);
		user_settings[e.target.id] = e.target.checked;
		console.table(user_settings);
	})));
	document.querySelector('select').addEventListener('change', e => {
		console.assert(['fra', 'spa', 'deu'].includes(e.target.value));
		user_settings['lang'] = e.target.value;
		console.table(user_settings);
	});
	const ya = document.querySelector('#ya');
	ya.value = user_settings['lang'];
	ya.addEventListener('click', _ => {
		localStorage.setItem('opt', JSON.stringify(user_settings));
		location.reload();
	});
} else {
	document.querySelector('.settings').style.display = 'none';
	user_settings = JSON.parse(localStorage.getItem('opt'));
}

const synth = window.speechSynthesis;
let voice = null;

const larss = [...document.querySelectorAll('.lars1')];
larss.forEach(x => x
	.addEventListener('click', _ => {
		voice = voice ?? synth.getVoices().filter(x => x.lang.startsWith('sv'))[0];
		let u = new SpeechSynthesisUtterance(CITAT[Math.floor(Math.random() * CITAT.length)]);
		u.voice = voice;
		synth.cancel();
		synth.speak(u);
	})
);

function frame() {
	const left = time_left();
	if (left < 1000 * 3600 * 5 && !YAY) {
		YAY = true;
		main_time_element.style.color = 'transparent';
		const audio = new Audio('rr.mp3');
		audio.loop = true;
		audio.play();
	}
	main_time_element.textContent = format_millis(left);
	requestAnimationFrame(frame);
}
requestAnimationFrame(frame);

[...document.querySelectorAll('.hover-c')].forEach(x => x.style.display = 'none');

setTimeout(_ => {
	[...document.querySelectorAll('.hover-c')].forEach(x => x.style.display = 'inline');
}, 1);